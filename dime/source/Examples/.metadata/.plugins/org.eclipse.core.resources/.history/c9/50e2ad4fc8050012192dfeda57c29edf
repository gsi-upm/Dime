<?php

require "res/Services/Twilio.php";
require "globals_dime.php";

// State wrongchoice implementation


	header("content-type: text/xml");
	
	// Update of the value of the global constants and variables, and the session params.
	if(isset($_GET['times_dime'])){
		$times_dime=$_GET['times_dime'];
	} 
	if(isset($_GET['month'])){
		$month=$_GET['month'];
	} 
	if(isset($_GET['day'])){
		$day=$_GET['day'];
	} 
	if(isset($_GET['hour'])){
		$hour=$_GET['hour'];
	} 
	if(isset($_GET['people'])){
		$people=$_GET['people'];
	} 
	
	
	if((!isset($_REQUEST['CallStatus']))||$_REQUEST["CallStatus"]=="in-progress"|| $_REQUEST["CallStatus"]=="ringing"|| $_REQUEST["CallStatus"]=="queued"){
	
	
		// Declaration of the statements of the state.
		
	echo "<?xml version=\"1.0\" encoding=\"UTF-8\"?> ";
	echo "<Response>";	
		if(($_GET['laststate_dime']=="askDay")){
				echo "<Say voice=\"man\" language=\"en\">"."Lo siento, no le hemos entendido. Tiene que decir un dia del mes"."</Say>\n"; 
		$completedurl_dime="http://shannon.gsi.dit.upm.es/roberto/askday.php";
				}
		else if(($_GET['laststate_dime']=="askHour")){
				echo "<Say voice=\"man\" language=\"en\">"."Lo siento, no le hemos entendido. Diga la hora a la que quiere hacer la reserva. Solo es posible hacer una reserva a las horas en punto o y media entre la una y las 11 y media de la noche."."</Say>\n"; 
		$completedurl_dime="http://shannon.gsi.dit.upm.es/roberto/askhour.php";
				}
		else if(($_GET['laststate_dime']=="askPeople")){
				echo "<Say voice=\"man\" language=\"en\">"."Lo siento, no le hemos entendido. Sepa ademas que el numero maximo de comensales es 10"."</Say>\n"; 
		$completedurl_dime="http://shannon.gsi.dit.upm.es/roberto/askpeople.php";
				}
		else if(($_GET['laststate_dime']=="askMonth")){
				$completedurl_dime="http://shannon.gsi.dit.upm.es/roberto/askmonth.php";
				}
		else if(($_GET['laststate_dime']=="askDone")){
				echo "<Say voice=\"man\" language=\"en\">"."Perdone, no le hemos entendido"."</Say>\n"; 
		$completedurl_dime="http://shannon.gsi.dit.upm.es/roberto/askdone.php";
				}
		else if(($_GET['laststate_dime']=="confirmation")){
				echo "<Say voice=\"man\" language=\"en\">"."Lo siento, no le hemos entendido. Los datos a modificar son: numero de comensales, mes, dia y hora de la reserva"."</Say>\n"; 
		$completedurl_dime="http://shannon.gsi.dit.upm.es/roberto/modification.php";
				}
		else {
				echo "<Say voice=\"man\" language=\"en\">"."Perdone, no le hemos entendido"."</Say>\n"; 
		$completedurl_dime="http://shannon.gsi.dit.upm.es/roberto/isclient.php";
				}
	
		if($getdigits_dime==TRUE){
			declareVoiceTag(getdigits)È
		}else{
		$url=$completedurl_dime."?"."laststate_dime=wrongchoice";
		if(isset($times_dime)){
			$url=$url."&amp;times_dime=".urlencode($times_dime);
		}if(isset($month)){
			$url=$url."&amp;month=".urlencode($month);
		}if(isset($day)){
			$url=$url."&amp;day=".urlencode($day);
		}if(isset($hour)){
			$url=$url."&amp;hour=".urlencode($hour);
		}if(isset($people)){
			$url=$url."&amp;people=".urlencode($people);
		}
		if(isset($hangupurl_dime)){
			$url=$url."&amp;hangupurl_dime=".urlencode($hangupurl_dime);
		}
		if(isset($errorurl_dime)){
			$url=$url."&amp;errorurl_dime=".urlencode($errorurl_dime);
		}
		if(isset($timesurl_dime)){
			$url=$url."&amp;timesurl_dime=".urlencode($timesurl_dime);
		}
		
		echo "<Redirect>".$url."</Redirect>";
		}
	
		echo "</Response>";
	}
	


	
?>